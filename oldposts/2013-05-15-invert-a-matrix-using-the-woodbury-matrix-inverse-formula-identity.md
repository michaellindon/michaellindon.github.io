---
id: 189
title: Invert a Matrix using the Woodbury Matrix Inverse Formula Identity
date: 2013-05-15T21:39:59+00:00
author: admin
layout: post
guid: http://www.lindonslog.com/?p=189
permalink: /mathematics/invert-a-matrix-using-the-woodbury-matrix-inverse-formula-identity/
categories:
  - Linear Algebra
  - Mathematics
---
Previously I wrote about the <a href="http://www.lindonslog.com/mathematics/diagonalize-positive-definite-symmetric-matrix-schur-complement-ldu-decomposition/" target="_blank">LDU decomposition and the Schur complement</a>. These can be further used to derive the Sherman–Morrison–Woodbury formula, otherwise known as the matrix inversion lemma, for inverting a matrix. As shown in the previous post, a UDL and LDU are two ways of factorizing a matrix:

<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D%3D++++%5Cbegin%7Bpmatrix%7D++++++++++1+%26++++V_%7B12%7DV_%7B22%7D%5E%7B-1%7D%5C%5C++0++++++%26+1%5C%5C++%5Cend%7Bpmatrix%7D++%5Cbegin%7Bpmatrix%7D+++++++++++V_%7B11.2%7D+%26+0+%5C%5C+++++++++++0+%26+V_%7B22%7D+%5C%5C+++%5Cend%7Bpmatrix%7D+++%5Cbegin%7Bpmatrix%7D++++++++++++1+%26+0+%5C%5C++V_%7B22%7D%5E%7B-1%7DV_%7B21%7D+%26+1+%5C%5C++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}=    &#92;begin{pmatrix}          1 &    V_{12}V_{22}^{-1}&#92;&#92;  0      & 1&#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}           V_{11.2} & 0 &#92;&#92;           0 & V_{22} &#92;&#92;   &#92;end{pmatrix}   &#92;begin{pmatrix}            1 & 0 &#92;&#92;  V_{22}^{-1}V_{21} & 1 &#92;&#92;  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}=    &#92;begin{pmatrix}          1 &    V_{12}V_{22}^{-1}&#92;&#92;  0      & 1&#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}           V_{11.2} & 0 &#92;&#92;           0 & V_{22} &#92;&#92;   &#92;end{pmatrix}   &#92;begin{pmatrix}            1 & 0 &#92;&#92;  V_{22}^{-1}V_{21} & 1 &#92;&#92;  &#92;end{pmatrix}  " class="latex" />

<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D++++%3D++%5Cbegin%7Bpmatrix%7D++++++++++1+%26+0%5C%5C++++++++++V_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+1%5C%5C++%5Cend%7Bpmatrix%7D++%5Cbegin%7Bpmatrix%7D++++++++++++V_%7B11%7D+%26+0+%5C%5C++0+%26+V_%7B22.1%7D+%5C%5C++%5Cend%7Bpmatrix%7D++%5Cbegin%7Bpmatrix%7D++++++++++++1+%26+V_%7B11%7D%5E%7B-1%7DV_%7B12%7D+%5C%5C++0+%26+1+%5C%5C++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}    =  &#92;begin{pmatrix}          1 & 0&#92;&#92;          V_{21}V_{11}^{-1} & 1&#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}            V_{11} & 0 &#92;&#92;  0 & V_{22.1} &#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}            1 & V_{11}^{-1}V_{12} &#92;&#92;  0 & 1 &#92;&#92;  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}    =  &#92;begin{pmatrix}          1 & 0&#92;&#92;          V_{21}V_{11}^{-1} & 1&#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}            V_{11} & 0 &#92;&#92;  0 & V_{22.1} &#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}            1 & V_{11}^{-1}V_{12} &#92;&#92;  0 & 1 &#92;&#92;  &#92;end{pmatrix}  " class="latex" />
  
Now consider taking the inverse of the matrices above, yielding

<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D%5E%7B-1%7D%3D++%5Cbegin%7Bpmatrix%7D++1+%26+0+%5C%5C++-V_%7B22%7D%5E%7B-1%7DV_%7B21%7D+%26+1+%5C%5C++%5Cend%7Bpmatrix%7D++++++%5Cbegin%7Bpmatrix%7D+++++++++++V_%7B11.2%7D%5E%7B-1%7D+%26+0+%5C%5C+++++++++++0+%26+V_%7B22%7D%5E%7B-1%7D+%5C%5C+++%5Cend%7Bpmatrix%7D+++%5Cbegin%7Bpmatrix%7D++++++++++1+%26+++-V_%7B12%7DV_%7B22%7D%5E%7B-1%7D%5C%5C++0++++++%26+1%5C%5C++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}=  &#92;begin{pmatrix}  1 & 0 &#92;&#92;  -V_{22}^{-1}V_{21} & 1 &#92;&#92;  &#92;end{pmatrix}      &#92;begin{pmatrix}           V_{11.2}^{-1} & 0 &#92;&#92;           0 & V_{22}^{-1} &#92;&#92;   &#92;end{pmatrix}   &#92;begin{pmatrix}          1 &   -V_{12}V_{22}^{-1}&#92;&#92;  0      & 1&#92;&#92;  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}=  &#92;begin{pmatrix}  1 & 0 &#92;&#92;  -V_{22}^{-1}V_{21} & 1 &#92;&#92;  &#92;end{pmatrix}      &#92;begin{pmatrix}           V_{11.2}^{-1} & 0 &#92;&#92;           0 & V_{22}^{-1} &#92;&#92;   &#92;end{pmatrix}   &#92;begin{pmatrix}          1 &   -V_{12}V_{22}^{-1}&#92;&#92;  0      & 1&#92;&#92;  &#92;end{pmatrix}  " class="latex" />

<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D%5E%7B-1%7D++%3D++%5Cbegin%7Bpmatrix%7D++1+%26+-V_%7B11%7D%5E%7B-1%7DV_%7B12%7D+%5C%5C++0+%26+1+%5C%5C++%5Cend%7Bpmatrix%7D++%5Cbegin%7Bpmatrix%7D++++++V_%7B11%7D%5E%7B-1%7D+%26+0+%5C%5C++0+%26+V_%7B22.1%7D%5E%7B-1%7D+%5C%5C++%5Cend%7Bpmatrix%7D++++%5Cbegin%7Bpmatrix%7D++++++++++1+%26+0%5C%5C++++++++++-V_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+1%5C%5C++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =  &#92;begin{pmatrix}  1 & -V_{11}^{-1}V_{12} &#92;&#92;  0 & 1 &#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}      V_{11}^{-1} & 0 &#92;&#92;  0 & V_{22.1}^{-1} &#92;&#92;  &#92;end{pmatrix}    &#92;begin{pmatrix}          1 & 0&#92;&#92;          -V_{21}V_{11}^{-1} & 1&#92;&#92;  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =  &#92;begin{pmatrix}  1 & -V_{11}^{-1}V_{12} &#92;&#92;  0 & 1 &#92;&#92;  &#92;end{pmatrix}  &#92;begin{pmatrix}      V_{11}^{-1} & 0 &#92;&#92;  0 & V_{22.1}^{-1} &#92;&#92;  &#92;end{pmatrix}    &#92;begin{pmatrix}          1 & 0&#92;&#92;          -V_{21}V_{11}^{-1} & 1&#92;&#92;  &#92;end{pmatrix}  " class="latex" />
  
Multiplying the matrices on the RHS yields
  
<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D%5E%7B-1%7D++%3D++%5Cbegin%7Bpmatrix%7D++V_%7B11.2%7D%5E%7B-1%7D+%26+-V_%7B11.2%7D%5E%7B-1%7DV_%7B12%7DV_%7B22%7D%5E%7B-1%7D%5C%5C++-V_%7B22%7D%5E%7B-1%7DV_%7B21%7DV_%7B11.2%7D%5E%7B-1%7D+%26+V_%7B22%7D%5E%7B-1%7D%2BV_%7B22%7D%5E%7B-1%7DV_%7B21%7DV_%7B11.2%7D%5E%7B-1%7DV_%7B12%7DV_%7B22%7D%5E%7B-1%7D++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =  &#92;begin{pmatrix}  V_{11.2}^{-1} & -V_{11.2}^{-1}V_{12}V_{22}^{-1}&#92;&#92;  -V_{22}^{-1}V_{21}V_{11.2}^{-1} & V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =  &#92;begin{pmatrix}  V_{11.2}^{-1} & -V_{11.2}^{-1}V_{12}V_{22}^{-1}&#92;&#92;  -V_{22}^{-1}V_{21}V_{11.2}^{-1} & V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  &#92;end{pmatrix}  " class="latex" />

<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D+%26+V_%7B12%7D%5C%5C++++++++++V_%7B21%7D+%26+V_%7B22%7D%5C%5C++%5Cend%7Bpmatrix%7D%5E%7B-1%7D++%3D%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D%5E%7B-1%7D%2BV_%7B11%7D%5E%7B-1%7DV_%7B12%7DV_%7B22.1%7D%5E%7B-1%7DV_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+-V_%7B11%7D%5E%7B-1%7DV_%7B12%7DV_%7B22.1%7D%5E%7B-1%7D%5C%5C++++++++++-V_%7B22.1%7D%5E%7B-1%7DV_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+V_%7B22.1%7D%5E%7B-1%7D++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =&#92;begin{pmatrix}          V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1} & -V_{11}^{-1}V_{12}V_{22.1}^{-1}&#92;&#92;          -V_{22.1}^{-1}V_{21}V_{11}^{-1} & V_{22.1}^{-1}  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}          V_{11} & V_{12}&#92;&#92;          V_{21} & V_{22}&#92;&#92;  &#92;end{pmatrix}^{-1}  =&#92;begin{pmatrix}          V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1} & -V_{11}^{-1}V_{12}V_{22.1}^{-1}&#92;&#92;          -V_{22.1}^{-1}V_{21}V_{11}^{-1} & V_{22.1}^{-1}  &#92;end{pmatrix}  " class="latex" />
  
These two results can be used to form neat expressions for the [inverse of a partitioned block matrix](http://www.lindonslog.com/mathematics/block-matrix-inverse/ "Block Matrix Inverse"). It follows that
  
<img src="//s0.wp.com/latex.php?latex=%5Cbegin%7Bpmatrix%7D++V_%7B11.2%7D%5E%7B-1%7D+%26+-V_%7B11.2%7D%5E%7B-1%7DV_%7B12%7DV_%7B22%7D%5E%7B-1%7D%5C%5C++-V_%7B22%7D%5E%7B-1%7DV_%7B21%7DV_%7B11.2%7D%5E%7B-1%7D+%26+V_%7B22%7D%5E%7B-1%7D%2BV_%7B22%7D%5E%7B-1%7DV_%7B21%7DV_%7B11.2%7D%5E%7B-1%7DV_%7B12%7DV_%7B22%7D%5E%7B-1%7D++%5Cend%7Bpmatrix%7D%3D++%5Cbegin%7Bpmatrix%7D++++++++++V_%7B11%7D%5E%7B-1%7D%2BV_%7B11%7D%5E%7B-1%7DV_%7B12%7DV_%7B22.1%7D%5E%7B-1%7DV_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+-V_%7B11%7D%5E%7B-1%7DV_%7B12%7DV_%7B22.1%7D%5E%7B-1%7D%5C%5C++++++++++-V_%7B22.1%7D%5E%7B-1%7DV_%7B21%7DV_%7B11%7D%5E%7B-1%7D+%26+V_%7B22.1%7D%5E%7B-1%7D++%5Cend%7Bpmatrix%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="&#92;begin{pmatrix}  V_{11.2}^{-1} & -V_{11.2}^{-1}V_{12}V_{22}^{-1}&#92;&#92;  -V_{22}^{-1}V_{21}V_{11.2}^{-1} & V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  &#92;end{pmatrix}=  &#92;begin{pmatrix}          V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1} & -V_{11}^{-1}V_{12}V_{22.1}^{-1}&#92;&#92;          -V_{22.1}^{-1}V_{21}V_{11}^{-1} & V_{22.1}^{-1}  &#92;end{pmatrix}  " title="&#92;begin{pmatrix}  V_{11.2}^{-1} & -V_{11.2}^{-1}V_{12}V_{22}^{-1}&#92;&#92;  -V_{22}^{-1}V_{21}V_{11.2}^{-1} & V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  &#92;end{pmatrix}=  &#92;begin{pmatrix}          V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1} & -V_{11}^{-1}V_{12}V_{22.1}^{-1}&#92;&#92;          -V_{22.1}^{-1}V_{21}V_{11}^{-1} & V_{22.1}^{-1}  &#92;end{pmatrix}  " class="latex" />
  
The equality holds for each block or element, so two expressions can be found for the Woodbury matrix inverse formula, namely:
  
<img src="//s0.wp.com/latex.php?latex=V_%7B11.2%7D%5E%7B-1%7D%3DV_%7B11%7D%5E%7B-1%7D%2BV_%7B11%7D%5E%7B-1%7DV_%7B12%7DV_%7B22.1%7D%5E%7B-1%7DV_%7B21%7DV_%7B11%7D%5E%7B-1%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="V_{11.2}^{-1}=V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1}  " title="V_{11.2}^{-1}=V_{11}^{-1}+V_{11}^{-1}V_{12}V_{22.1}^{-1}V_{21}V_{11}^{-1}  " class="latex" />
  
and
  
<img src="//s0.wp.com/latex.php?latex=V_%7B22.1%7D%5E%7B-1%7D%3DV_%7B22%7D%5E%7B-1%7D%2BV_%7B22%7D%5E%7B-1%7DV_%7B21%7DV_%7B11.2%7D%5E%7B-1%7DV_%7B12%7DV_%7B22%7D%5E%7B-1%7D++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="V_{22.1}^{-1}=V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  " title="V_{22.1}^{-1}=V_{22}^{-1}+V_{22}^{-1}V_{21}V_{11.2}^{-1}V_{12}V_{22}^{-1}  " class="latex" />
  
where the dot notation corresponds to the Schur complement i.e.
  
<img src="//s0.wp.com/latex.php?latex=V_%7B11.2%7D%3DV_%7B11%7D-V_%7B12%7DV_%7B22%7D%5E%7B-1%7DV_%7B21%7D%5C%5C++V_%7B22.1%7D%3DV_%7B22%7D-V_%7B21%7DV_%7B11%7D%5E%7B-1%7DV_%7B12%7D%5C%5C++&#038;bg=ffffff&#038;fg=000&#038;s=0" alt="V_{11.2}=V_{11}-V_{12}V_{22}^{-1}V_{21}&#92;&#92;  V_{22.1}=V_{22}-V_{21}V_{11}^{-1}V_{12}&#92;&#92;  " title="V_{11.2}=V_{11}-V_{12}V_{22}^{-1}V_{21}&#92;&#92;  V_{22.1}=V_{22}-V_{21}V_{11}^{-1}V_{12}&#92;&#92;  " class="latex" />
  
An application of the Woodbury matrix inverse can be found in deriving [conditional distributions](http://www.lindonslog.com/mathematics/woodbury-matrix-inverse-multivariate-normal/ "Woodbury Matrix Inverse") for multivariate normals.